# **1. Preparació de l’entorn**

- Maquines Virtuals  
  ![][image1]  
  ![][image2]

# **2. Preparació del servidor**

- Farem un ping a la maquina client desde la maquina server per assegurar la connectivitat  
  ![][image3]   
- Començarem creant el grup devs i el grup admins  
  ![][image4]  
- Crearem l’usuari dev01 amb carpeta personal  
  ![][image5]  
- L’afagirem com a grup secundari a devs  
  ![][image6]  
- Crearem l’usuari amb carpeta personal admin01 i l’afagirem al grup secundari admins  
  ![][image7]  
- Crearem els seguents directoris /srv/nfs/dev\_projects crearem tambe la carpeta admin\_tools  
  ![][image8]  
- donarem el usuari propietari root als 2 directoris dev\_projects i admin\_tools i de grup propietari admin per admin\_tools i devs per dev\_projects dibaren els permisos 770  
  ![][image9]  
- Posarem com a propietari de /srv/nfs cap usuari ni grup i posarem de permisos 770  
  ![][image10]  
- Afagirem els mateixos grups i usuaris al client  
  ![][image11]  
  ![][image12]  
  ![][image13]  
- Instalarem el servei client nfs a la maquina client  
  ![][image14]  
- Instalarem el servei de nfs server al nostre server  
  ![][image15]  
- Editarem el arxiu de /etc/exports i compartirem la carpeta /srv/nfs a la nostra maquina client (posarem la ip del client perquè \* pot donar problemes de manera inexplicable)  
  ![][image16]  
- Ara reinciarem el servei   
- utilitzarem showmount per veure que recursos ens esta compartint el server  
  ![][image17]  
- crearem un directori en el cual montarem el directori que ens esta compartint el server  
  ![][image18]  
- Muntarem el directori que ens comparteix el server a la carpeta que em creat  
  ![][image19]  
- Veurem que tenim els directoris que hem muntat que ens ha compartit el server   
  ![][image20]

# **3. L’exportació d’administració.**

- editem el arxiu de /etc/exports i compartirem ara la carpeta /srv/nfs/admin\_tools amb els permisos rw, sync  
  ![][image21]  
- Reiniciem el servei nfs al server  
  ![][image22]  
- Amb la comanda comprovarem que s’estigui compartint el directori correcte  
  ![][image23]  
- Crearem el seguent directori /mnt/admin\_tools per montar admin\_tools  
  ![][image24]  
- Ara montarem el directori compartit del server a la carpeta que em creat abanç  
  ![][image25]


## **3.1 El dilema del root\_squash**


- El dilema del **root Squash:** Si intentas accedir o crear al directori /mnt/admin\_tools com a root no ens deixara, aixo es degut a que per default nfs te la opcio root\_squash habilitada. Aquesta opcio fa que el usuari root del client sigui nobody al server i aques usuari no té permisos per que no esta dins de cap grup o usuari amb permisos.  
  ![][image26]  
- Ara amb admin01 si que podem accedir ja que forma part del grup propietari de la carpeta admins.  
  ![][image27]  
  ![][image28]

## **3.2 Solució del dilema del root\_squash**

- Ara cambiarem les opcions del recurs compartit i posarem no\_root\_squash el que deshabilitarà aquesta protecció.  
  ![][image29]  
- **Reiniciem el servei**  
  sudo systemctl restart nfs-kernel-server.service  
- desmontem el recurs compartit i el tornem a montar per que s’apliquin els cambis  
  sudo umount /mnt/admin\_tools  
  sudo mount \-t nfs 192.168.56.203:/srv/nfs/admin\_tools /mnt/admin\_tools  
- Com podem veure ja ens deixa crear un arxiu com a root degut a que ara estem com a root pel server també  
  ![][image30]  
  ![][image31]

# **4. L’exportació de Desenvolupament**

- Ara editarem l’arxiu /etc/exports i posarem que es comparteixi amb permisos de escriure i llegir al nostre client pero que per la resta de la xarxa només puguin llegir  
  ![][image32]  
- reiniciem el servei  
  sudo systemctl restart nfs-kernel-server.service  
- Crearem al client el directori per muntar el recurs i muntarem el recurs   
  sudo mkdir /mnt/dev\_projects  
  sudo mount \-t nfs 192.168.56.104:/srv/nfs/dev\_projects /mnt/dev\_projects  
- Entrarem com a dev01 i escriurem al directori  
  touch /mnt/dev\_projects/dev01.txt  
  ![][image33]  
- desmuntem el recurs compartit  
  sudo umount /mnt/dev\_projects  
- cambiem la ip per una que estigui dins del rang de ips que em configurat abanç  
  ip a  
  ![][image34]  
- amb la ip muntem el recurs i veurem com nomes podem llegir encara que siguem com a dev  
  touch /mnt/dev\_projects/dev01.txt  
  ![][image35]  
- Cambiem a admin01 i intentem esciure veurem com el codi de error es diferent  
  touch /mnt/dev\_projects/admin01.txt  
  ![][image36]

# **5. Muntatge Automatic amb /etc/fstab**

- Em de tenir tots els recursos que volem compartir al arxiu /etc/exports al server  
  ![][image37]  
- Una vegada asegurat aixo editarem l’arxiu /etc/fstab aixo amb la finalitat de muntar els recursos automaticament cada vegada que reiniciem el sistema posem:  
  ip:/ruta /ruta\_per\_muntar nfs default 0 0  
  ![][image38]  
- Comprobarem si les entrades funcionen sense reiniciar amb  
  sudo mount \-a  
- Reiniciarem la maquina i mirarem si s’han muntat els recursos compartits  
  ![][image39]  
- com podem veure s’han muntat correctament	

# **6. Conclusió**

Dins de aquesta experiencia amb NFS he pugut veure que es una bona alternativa tot i que em sembla poc practic per part dels tecnics i poc escalable dins de un entorn més gran degut a que la seva configuracio depen de que els GID i UID coincideixin entre client i server a més tambe es poc segur  
seria aconsejable anar-se a un servei de identitat centralitzada com ldap la cual es una opcio molt més segura i escalable en un entorn laborable
